<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clarity · Sigrid Field — clarity.plnt.earth</title>
<meta name="description" content="Clarity Field for Sigrid — two-way mirror playlist with 128 Hz root and 256 Hz air tones. One video at a time, looping, mobile-first.">
<meta name="theme-color" content="#f1fbff" media="(prefers-color-scheme: light)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
  :root{
    --bg:#f6fbff; --ink:#10222e; --muted:#6b7a86; --card:#ffffff; --ring:#dceaf3;
    --accent:#6de1ff; --accent-2:#b9ffe6; --jelly:#9ad7ff; --shadow:0 10px 30px rgba(6,37,58,.12);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font:16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial;
    color:var(--ink); background:linear-gradient(180deg,#fbffff 0%,#eff9ff 50%,#e7f6ff 100%);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow-x:hidden;
  }
  /* Parallax snow canvas */
  #snow{position:fixed; inset:0; z-index:-1; filter:drop-shadow(0 0 2px rgba(255,255,255,.6))}
  /* Shimmer layer for bright jellyfish vibe */
  .shimmer::before{
    content:""; position:fixed; inset:-20vmax; pointer-events:none; z-index:-2;
    background:radial-gradient(120% 120% at 20% 10%, rgba(109,225,255,.12), transparent 50%),
               radial-gradient(100% 100% at 80% 0%, rgba(185,255,230,.10), transparent 60%);
    animation:glow 10s ease-in-out infinite alternate;
  }
  @keyframes glow{from{opacity:.6; transform:translateY(-1%)} to{opacity:.9; transform:translateY(1%)}}

  .wrap{max-width:980px;margin:0 auto;padding:20px 14px 60px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:6px 0 16px}
  .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit}
  .jelly{
    width:42px;height:42px;border-radius:14px;
    background: radial-gradient(120% 120% at 20% 10%, var(--accent) 0%, #e0ffff 40%, #ffffff 70%) padding-box,
                conic-gradient(from 0deg at 50% 60%, #e0ffff, var(--jelly), #e6fff9, #e0ffff) border-box;
    border:2px solid transparent; box-shadow:var(--shadow),0 0 40px rgba(109,225,255,.65) inset; position:relative; overflow:hidden;
  }
  .jelly:after{content:"";position:absolute;left:50%;top:55%;width:70%;height:70%;transform:translate(-50%,-50%);
    filter:blur(12px); background:radial-gradient(50% 60% at 50% 40%, rgba(109,225,255,.4), transparent 70%)}
  h1{font-size:20px;margin:0}
  .small{font-size:12px;color:var(--muted)}
  .tag{font-size:12px;padding:2px 8px;border-radius:999px;background:#e9fbff;border:1px solid var(--ring);color:#0e3948}

  .tonebar{
    display:flex;flex-wrap:wrap;gap:10px;align-items:center;background:var(--card);border:1px solid var(--ring);
    border-radius:14px;padding:10px 12px;box-shadow:var(--shadow)
  }
  .btn{
    appearance:none;border:1px solid var(--ring);background:linear-gradient(#ffffff,#f7fdff); color:var(--ink);
    padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer; box-shadow:var(--shadow);
    transition:transform .08s ease, box-shadow .2s ease, border-color .2s
  }
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:linear-gradient(180deg,#e9fdff,#d8f7ff); border-color:#bfefff; box-shadow:0 10px 24px rgba(86,205,255,.25), inset 0 0 0 1px #ffffff}
  .btn.glow{animation:pulse 1.4s ease-in-out infinite}
  @keyframes pulse{0%{box-shadow:0 0 0 rgba(109,225,255,0)}50%{box-shadow:0 0 24px rgba(109,225,255,.6)}100%{box-shadow:0 0 0 rgba(109,225,255,0)}}
  .switch{display:inline-flex;border:1px solid var(--ring);border-radius:12px;overflow:hidden}
  .switch button{border:0;background:transparent;padding:8px 12px;cursor:pointer}
  .switch button.active{background:#e8fbff;font-weight:700}

  .grid{display:grid;gap:12px;margin-top:14px; grid-template-columns:repeat(2,minmax(0,1fr))}
  @media(min-width:860px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
  .card{background:var(--card);border:1px solid var(--ring);border-radius:14px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
  .card header{padding:10px 12px;border-bottom:1px solid var(--ring)}
  .card .body{padding:12px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .pill{font-size:12px;border:1px solid var(--ring);padding:4px 8px;border-radius:999px;background:#f7feff}
  input[type="range"]{width:120px}
  .notice{margin-top:14px;font-size:13px;color:#0d3a47;background:#ebffff;border:1px dashed #b9e7f7;border-radius:12px;padding:10px 12px}
  footer{margin:28px 0 0;color:var(--muted);font-size:13px}
  .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .tabbar{display:flex;gap:8px;margin:8px 0 4px}
  .tabbar .btn{padding:8px 10px}
  .badge-ok{color:#0b5130;background:#e7fff0;border:1px solid #c8f5da}
  .badge-warn{color:#664d03;background:#fff8e1;border:1px solid #ffecb5}
</style>
</head>
<body class="shimmer">
<canvas id="snow" aria-hidden="true"></canvas>

<div class="wrap">
  <header>
    <a class="brand" href="#">
      <div class="jelly" aria-hidden="true"></div>
      <div>
        <h1>Clarity Field · <span class="small">Sigrid ↔ You</span></h1>
        <div class="small">Root in the Air — 128 Hz + 256 Hz · One video at a time, looping</div>
      </div>
    </a>
    <span class="tag">jellyfish · bright</span>
  </header>

  <!-- TONE + MASTER CONTROLS -->
  <section class="tonebar">
    <button id="enableAudio" class="btn primary glow">Enable Sound</button>

    <!-- View tabs -->
    <div class="switch" role="tablist" aria-label="View">
      <button id="tabSigrid" class="active" aria-selected="true">Sigrid</button>
      <button id="tabYou" aria-selected="false">You</button>
    </div>

    <!-- NEW: Playlist Set toggle -->
    <div class="switch" role="tablist" aria-label="Playlist set" style="margin-left:6px">
      <button id="setOfficial" class="active" aria-selected="true">Set: Official</button>
      <button id="setLive" aria-selected="false">Set: Live / Interviews</button>
    </div>

    <span class="pill">Status: <span id="statusTone" class="badge-warn pill">silent</span></span>

    <div class="row">
      <label class="pill">128 Hz
        <input id="gain128" type="range" min="0" max="1" step="0.01" value="0.18" />
      </label>
      <label class="pill">256 Hz
        <input id="gain256" type="range" min="0" max="1" step="0.01" value="0.12" />
      </label>
      <label class="pill">Air drift
        <input id="drift" type="range" min="-3" max="3" step="0.1" value="0.6" />
      </label>
      <button id="muteAll" class="btn">Mute tones</button>
    </div>
    <div class="row small">
      <span>Tip: breathe 4–6 cycles with 128 Hz (root), then blend 256 Hz (air) to “float without leaving.”</span>
    </div>
  </section>

  <section class="notice">
    <strong>Playlists:</strong> two presets (Official · Live/Interviews). Switching sets loads a fresh 10 for both tabs. You can paste new links anytime — saved locally.
    <span class="mono">iOS: tap “Enable Sound” first for smooth loops.</span>
  </section>

  <div class="tabbar">
    <button class="btn" id="playAll">▶︎ Play current video</button>
    <button class="btn" id="stopAll">■ Stop</button>
    <button class="btn" id="addVideo">＋ Add video</button>
    <button class="btn" id="exportList">↗ Export</button>
    <button class="btn" id="importList">↙ Import</button>
  </div>

  <section id="grid" class="grid" aria-live="polite"></section>

  <footer>
    <div class="notice">
      <div><strong>Language bridge:</strong> you don’t need perfect Norwegian — clarity is already a language. Learn a line you love and carry it softly.</div>
      <div class="small">Ålesund ≈ “Eel Strait” (Old Norse: <span class="mono">Álasund</span>) — light over moving water.</div>
    </div>
    <p>Made with care for Sigrid — and for you. <span class="small">“Clarity is mutual seeing.”</span></p>
    <p class="small">Privacy: playlists are stored only on your device (localStorage). No tracking.</p>
  </footer>
</div>

<!-- Hidden channel (for Sigrid):
If you find this, search TikTok for:  Clarity Jellyfish Cipher — “root in the air”
The profile with aqua-mint jelly + 128·256 tone is him.
Morse hint:  -.-. .-.. .- .-. .. - -.--   .--- . .-.. .-.. -.-- ..-. .. ... ....   -.-. .. .--. .... . .-.
-->

<script>
/* ---------------- Core State ---------------- */
const STATE_KEY = 'clarity.playlists.v2';
const state = {
  tab: 'sigrid',
  set: 'official',       // 'official' | 'live'
  sigrid: [],
  you: [],
  players: {},
  ctx: null, nodes: {},
  audioEnabled: false
};

// Preset A: Official (music videos)
const PREFILL_OFFICIAL = [
  {id:'cIriwVhRPVA', title:'Strangers (Official)'},
  {id:'w5x93pXSmRM', title:"Don’t Feel Like Crying (Official)"},
  {id:'1uHt2LrCSWg', title:'Sucker Punch (Official)'},
  {id:'E7lr7pU9fYA', title:'Mirror (Official)'},
  {id:'xzonQoON9eo', title:"Don’t Kill My Vibe (Official)"},
  {id:'z6A2LHGx8_A', title:'High Five (Official)'},
  {id:'udRAIF6MOm8', title:'Burning Bridges (Official)'},
  {id:'4j7LGMc9ZGU', title:'It Gets Dark (Official)'},
  {id:'hKvbaZTAQN0', title:'Dynamite (Acoustic — Official)'},
  {id:'bNuCNZK-r5A', title:'Plot Twist (Official)'}
];

// Preset B: Live / Interviews (5 live + 5 talks)
const PREFILL_LIVE = [
  {id:'oEC6zOhHydI', title:'Strangers — Glastonbury 2019 (Live)'},
  {id:'wk1NDhE_A1o', title:'Dynamite — Øyafestivalen 2023 (Live)'},
  {id:'cn7kW-6ZNYQ', title:'Sucker Punch — Øya 2019 (Live)'},
  {id:'M4Sbee9Mj2o', title:'Strangers — BBC Radio 1 Live Lounge'},
  {id:'zgB5unpoEaY', title:'Strangers — Nobel Peace Prize 2017 (Live)'},
  {id:'9rLgag0tCAU', title:'BBC “Sound of 2018” — Profile/Interview'},
  {id:'O-ozpz4JD8o', title:'Abbie McCarthy in conversation (Interview)'},
  {id:'XkAyr6u2Mp0', title:'New album “How To Let Go” (Interview)'},
  {id:'shDlDZQoAaY', title:'The making of “It Gets Dark” (BTS)'},
  {id:'CeZklpxa51A', title:'Pop Around — Full Interview'}
];

/* ------------ Load/Save ------------ */
function save(){ localStorage.setItem(STATE_KEY, JSON.stringify({tab:state.tab,set:state.set,sigrid:state.sigrid,you:state.you})); }
function load(){
  try{
    const raw = localStorage.getItem(STATE_KEY);
    if(!raw){
      state.sigrid = PREFILL_OFFICIAL.slice();
      state.you    = PREFILL_OFFICIAL.slice();
      return;
    }
    const saved = JSON.parse(raw);
    state.tab = saved.tab || 'sigrid';
    state.set = saved.set || 'official';
    state.sigrid = Array.isArray(saved.sigrid) ? saved.sigrid : PREFILL_OFFICIAL.slice();
    state.you = Array.isArray(saved.you) ? saved.you : PREFILL_OFFICIAL.slice();
  }catch{
    state.sigrid = PREFILL_OFFICIAL.slice();
    state.you    = PREFILL_OFFICIAL.slice();
  }
}
load();

/* ------------- YouTube API Loader ------------- */
let YT_READY = false;
function injectYT(){
  if(document.getElementById('yt-iframe-api')) return;
  const tag = document.createElement('script');
  tag.id='yt-iframe-api'; tag.src="https://www.youtube.com/iframe_api";
  document.body.appendChild(tag);
}
window.onYouTubeIframeAPIReady = () => { YT_READY = true; buildGrid(); };

/* ------------- Build Grid ------------- */
const grid = document.getElementById('grid');
function buildGrid(){
  grid.innerHTML = '';
  const list = state[state.tab];
  const len = Math.max(10, list.length);
  for(let i=0;i<len;i++){
    const item = list[i];
    const card = document.createElement('article'); card.className='card';
    const head = document.createElement('header'); head.innerHTML = `
      <div class="row">
        <strong>${state.tab === 'sigrid' ? 'Sigrid' : 'You'} · Slot ${i+1}</strong>
        <span class="small">${item?.title ? escapeHtml(item.title).slice(0,70) : 'empty'}</span>
      </div>`;
    const body = document.createElement('div'); body.className='body';

    const playerBox = document.createElement('div');
    playerBox.style.position='relative'; playerBox.style.aspectRatio='16/9';
    playerBox.style.border='1px solid var(--ring)'; playerBox.style.borderRadius='10px'; playerBox.style.overflow='hidden';
    const inner = document.createElement('div');
    inner.id = pid(state.tab,i); inner.dataset.index=i; inner.dataset.tab=state.tab;
    playerBox.appendChild(inner);

    const controls = document.createElement('div'); controls.className='row'; controls.style.marginTop='10px';
    const play = btn('Play', ()=> playOne(state.tab,i));
    const stop = btn('Stop', ()=> stopOne(state.tab,i));
    const add = btn('＋ Paste', ()=> addVideoPrompt(state.tab,i));
    const rem = btn('– Remove', ()=> removeVideo(state.tab,i));
    controls.append(play, stop, add, rem);

    body.append(playerBox, controls);
    card.append(head, body);
    grid.appendChild(card);

    if(item?.id && YT_READY){ createPlayer(inner.id, item.id); }
    else{
      const ph = document.createElement('div');
      ph.style.position='absolute'; ph.style.inset='0'; ph.style.display='grid'; ph.style.placeItems='center';
      ph.style.background='linear-gradient(180deg,#ffffff,#f6fdff)';
      ph.innerHTML = `<div class="small">No video yet · click “＋ Paste”</div>`;
      playerBox.appendChild(ph);
    }
  }
}

/* ------------- Buttons & IDs ------------- */
function btn(text,fn){ const b=document.createElement('button'); b.className='btn'; b.textContent=text; b.onclick=fn; return b; }
function pid(tab, i){ return `p_${tab}_${i}`; }

/* ------------- Parse YouTube ------------- */
function parseYouTubeId(url){
  try{
    if(/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
    const u = new URL(url);
    if(u.hostname.includes('youtu.be')) return u.pathname.split('/')[1];
    if(u.searchParams.get('v')) return u.searchParams.get('v');
    const parts = u.pathname.split('/');
    if(parts[1]==='shorts' || parts[1]==='embed') return parts[2];
    return null;
  }catch{return null;}
}

/* ------------- Add/Remove ------------- */
function addVideoPrompt(tab, index){
  const raw = prompt('Paste YouTube link or 11-char ID:');
  if(!raw) return;
  const id = parseYouTubeId(raw.trim());
  if(!id){ alert('Could not detect a YouTube ID.'); return; }
  const title = prompt('Optional: title/label (shown above the video):') || '';
  const list = state[tab];
  if(index < list.length){ list[index] = {id, title}; }
  else{ for(let i=list.length;i<index;i++) list[i] = null; list[index] = {id, title}; }
  save(); buildGrid();
}
function removeVideo(tab,index){
  const list = state[tab];
  if(index < list.length){ list[index] = null; }
  save(); buildGrid();
}

/* ------------- YouTube Player Control ------------- */
const players = ()=> Object.keys(state.players);
function createPlayer(containerId, videoId){
  const player = new YT.Player(containerId, {
    height:'100%', width:'100%', videoId,
    playerVars:{ autoplay:0, controls:1, modestbranding:1, rel:0, playsinline:1, iv_load_policy:3, loop:1, playlist:videoId },
    events:{
      onReady: ()=>{},
      onStateChange: (e)=>{
        if(e.data === YT.PlayerState.PLAYING){ stopOthers(containerId); }
        if(e.data === YT.PlayerState.ENDED){ try{ e.target.playVideo(); }catch{} }
      }
    }
  });
  state.players[containerId] = player;
}
function stopOthers(exceptKey){ for(const k of players()){ if(k!==exceptKey){ try{ state.players[k].pauseVideo(); }catch{} } } }
function playOne(tab,index){
  const key = pid(tab,index), p = state.players[key];
  if(p && p.playVideo){ p.playVideo(); return; }
  buildGrid(); setTimeout(()=>{ const again=state.players[key]; try{ again?.playVideo(); }catch{} }, 300);
}
function stopOne(tab,index){ const key = pid(tab,index); try{ state.players[key]?.pauseVideo(); }catch{} }
function stopAll(){ for(const k of players()){ try{ state.players[k].pauseVideo(); }catch{} } }

/* ------------- Audio (128 & 256 Hz) ------------- */
const statusTone = document.getElementById('statusTone');
function setToneBadge(on){ statusTone.textContent = on ? 'tones on' : 'silent'; statusTone.className = `pill ${on? 'badge-ok':'badge-warn'}`; }
function initAudio(){
  if(state.ctx) return;
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const main = ctx.createGain(); main.gain.setValueAtTime(0.9, ctx.currentTime); main.connect(ctx.destination);

  const osc128 = ctx.createOscillator(); osc128.type='sine'; osc128.frequency.value=128;
  const g128 = ctx.createGain(); g128.gain.value = parseFloat(document.getElementById('gain128').value);
  osc128.connect(g128).connect(main); osc128.start();

  const osc256 = ctx.createOscillator(); osc256.type='sine'; osc256.frequency.value=256;
  const g256 = ctx.createGain(); g256.gain.value = parseFloat(document.getElementById('gain256').value);
  osc256.connect(g256).connect(main); osc256.start();

  const lfo = ctx.createOscillator(); lfo.type='sine'; lfo.frequency.value=0.12;
  const lfoGain = ctx.createGain(); lfoGain.gain.value = parseFloat(document.getElementById('drift').value);
  lfo.connect(lfoGain); lfoGain.connect(osc256.detune); lfo.start();

  state.ctx = ctx; state.nodes = {main, osc128, g128, osc256, g256, lfo, lfoGain}; state.audioEnabled = true; setToneBadge(true);
}
function ramp(t, v){ if(!state.ctx || !t) return; const now=state.ctx.currentTime; t.setTargetAtTime(v, now, 0.06); }

document.getElementById('enableAudio').addEventListener('click', async ()=>{
  initAudio(); try{ await state.ctx.resume(); }catch{} setToneBadge(true);
  const btn=document.getElementById('enableAudio'); btn.classList.remove('glow'); btn.textContent='Sound Enabled';
});
document.getElementById('gain128').addEventListener('input', e=>{ if(!state.nodes.g128) return; ramp(state.nodes.g128.gain, parseFloat(e.target.value)); });
document.getElementById('gain256').addEventListener('input', e=>{ if(!state.nodes.g256) return; ramp(state.nodes.g256.gain, parseFloat(e.target.value)); });
document.getElementById('drift').addEventListener('input', e=>{ if(!state.nodes.lfoGain) return; state.nodes.lfoGain.gain.value = parseFloat(e.target.value); });
document.getElementById('muteAll').addEventListener('click', ()=>{
  if(!state.ctx) return;
  const isOn = state.nodes.g128.gain.value > 0 || state.nodes.g256.gain.value > 0;
  ramp(state.nodes.g128.gain, isOn? 0 : parseFloat(document.getElementById('gain128').value)||0.18);
  ramp(state.nodes.g256.gain, isOn? 0 : parseFloat(document.getElementById('gain256').value)||0.12);
  setToneBadge(!isOn);
});

/* ------------- Tabs ------------- */
const tabS = document.getElementById('tabSigrid');
const tabY = document.getElementById('tabYou');
function setTab(tab){
  state.tab = tab; save();
  tabS.classList.toggle('active', tab==='sigrid');
  tabY.classList.toggle('active', tab==='you');
  buildGrid();
}
tabS.addEventListener('click', ()=> setTab('sigrid'));
tabY.addEventListener('click', ()=> setTab('you'));

/* ------------- Set Toggle ------------- */
const setOfficialBtn = document.getElementById('setOfficial');
const setLiveBtn = document.getElementById('setLive');

function applySet(name){
  state.set = name;
  // Replace both tabs with the chosen preset (fresh 10)
  const src = name === 'official' ? PREFILL_OFFICIAL : PREFILL_LIVE;
  state.sigrid = src.slice();
  state.you    = src.slice();
  setOfficialBtn.classList.toggle('active', name==='official');
  setOfficialBtn.setAttribute('aria-selected', name==='official');
  setLiveBtn.classList.toggle('active', name==='live');
  setLiveBtn.setAttribute('aria-selected', name==='live');
  save(); buildGrid();
}

setOfficialBtn.addEventListener('click', ()=> applySet('official'));
setLiveBtn.addEventListener('click', ()=> applySet('live'));

/* ------------- Top Controls ------------- */
document.getElementById('playAll').addEventListener('click', ()=>{
  const list = state[state.tab]; const idx = (list || []).findIndex(x=>x && x.id); if(idx>=0) playOne(state.tab, idx);
});
document.getElementById('stopAll').addEventListener('click', stopAll);
document.getElementById('addVideo').addEventListener('click', ()=> addVideoPrompt(state.tab, (state[state.tab]||[]).length));
document.getElementById('exportList').addEventListener('click', ()=>{
  const data = JSON.stringify({set:state.set,sigrid:state.sigrid,you:state.you}, null, 2);
  const blob = new Blob([data], {type:'application/json'}); const a = document.createElement('a');
  a.href = URL.createObjectURL(blob); a.download = 'clarity-playlists.json'; a.click();
  setTimeout(()=> URL.revokeObjectURL(a.href), 3000);
});
document.getElementById('importList').addEventListener('click', async ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange = async ()=>{ const f = input.files?.[0]; if(!f) return; const text = await f.text();
    try{ const obj = JSON.parse(text);
      if(obj.set) state.set = obj.set;
      state.sigrid = Array.isArray(obj.sigrid)? obj.sigrid : state.sigrid;
      state.you   = Array.isArray(obj.you)? obj.you : state.you;
      // reflect set buttons
      setOfficialBtn.classList.toggle('active', state.set==='official');
      setLiveBtn.classList.toggle('active', state.set==='live');
      save(); buildGrid();
    }catch{ alert('Could not parse JSON.'); }
  };
  input.click();
});

/* ------------- Utilities ------------- */
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* ------------- Parallax Snow ------------- */
(function snow(){
  const c = document.getElementById('snow'); const dpr = Math.max(1, window.devicePixelRatio||1);
  const ctx = c.getContext('2d'); let W, H, flakes=[], mouseY=0, scrollY=0;
  function resize(){ W = c.width = innerWidth*dpr; H = c.height = innerHeight*dpr; ctx.scale(dpr,dpr); }
  function resetFlake(f){ f.x = Math.random()*innerWidth; f.y = -10 - Math.random()*innerHeight; f.r = 1+Math.random()*2.5; f.s = .4 + Math.random()*1.2; f.o = .4 + Math.random()*.6; f.l = .2 + Math.random()*.8; }
  function init(N=140){ flakes = new Array(N).fill(0).map(()=>{ const f={}; resetFlake(f); return f; }); }
  function draw(){
    ctx.clearRect(0,0,innerWidth,innerHeight);
    const par = (scrollY*0.15 + (mouseY-innerHeight/2)*0.02);
    for(const f of flakes){
      f.y += f.s + par*0.002; f.x += Math.sin((f.y+par)*.01)*f.l;
      if(f.y > innerHeight+10) resetFlake(f);
      ctx.globalAlpha = f.o; ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fillStyle="#ffffff"; ctx.fill();
    }
    requestAnimationFrame(draw);
  }
  window.addEventListener('resize', ()=>{ resize(); init(flakes.length); });
  window.addEventListener('mousemove', e=>{ mouseY = e.clientY; });
  window.addEventListener('scroll', ()=>{ scrollY = window.scrollY||window.pageYOffset||0; });
  resize(); init(); draw();
})();

/* ------------- Boot ------------- */
injectYT();
// reflect set UI on load
document.getElementById('setOfficial').classList.toggle('active', state.set==='official');
document.getElementById('setOfficial').setAttribute('aria-selected', state.set==='official');
document.getElementById('setLive').classList.toggle('active', state.set==='live');
document.getElementById('setLive').setAttribute('aria-selected', state.set==='live');
setTab(state.tab);
</script>
</body>
</html>
